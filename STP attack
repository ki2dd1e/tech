STP протокол предотвращает петли, выбирая Root bridge на основании MAC адреса и приоритета, тогда как остальные коммутаторы имеют Root (кратчайший до Root bridge), Designated (форвардит на Root порт) и Block (в режиме listen) порты. На саму идею атаки может навести мысль, что STP сам по себе не имеет средств защиты при выборе Root, а каждое новое подключение коммутатора запускает т.н. режим обучения и изменяет "топологию" STP: все коммутаторы обмениваются BPDU-пакетами для изменения состояний портов и назначения Root bridge.
Примечание: интересно, что, соединив 2 коммутатора между собой, access порт до клиента может быть заблокирован благодаря STP - это и есть описанный выше режим обучения; для решения проблемы следует либо отключить STP (что не есть хорошо), либо включить portfast, о чем пойдет речь далее.
Таким образом, представившись коммутатором и подделав MAC адрес и/или приоритет, атакующий может стать Root bridge, что в свою очередь позволит ...
Стенд состоит из 3 коммутаторов SW1, SW2, SW3, соединенных в Mesh сеть и передающих через trunk только стандартный VLAN 1. Клиенты Exdiction121, Exdiction122 находятся в VLAN 1 и имеют адреса 1.1.1.1 и 1.1.1.2 соответственно.
![alt text](https://github.com/ki2dd1e/tech/blob/main/STP.PNG)
Вывод spanning-tree с коммутаторов представлен в таблице:
      SW1      SW2      SW3
0/0  desg      root    desg
0/1  desg      desg    block
0/2  desg      desg    desg
0/3  desg      desg    desg
Таким образом, коммутатор SW2 имеет Root bridge на порте 0/0, и трафик идет "против часовой стрелки" в текущей конфигурации STP.
Машина атакующего подключена к 2 access портам SW1, SW2, с них можно собрать трафик и найти в нем BPDU пакеты.
На порте e1 видно, что Root Bridge Priority равен 32768, MAC адрес коммутатора с Root Bridge равен aa:bb:cc:03:30:00.
